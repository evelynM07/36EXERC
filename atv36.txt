/*ATIVIDADE 1*/
UPDATE  DEBITOS SET SITUACAO_DEBITO = 'Atrasado'
WHERE DATAVENCIMENTO < CURRENT_DATE
AND SITUACAO_DEBITO NOT IN ('Negociado', 'Pago');

/*ATIVIDADE 2*/
UPDATE DEBITOS SET SITUACAO_DEBITO = 'Pendente'
WHERE DATAVENCIMENTO > CURRENT_DATE
AND SITUACAO_DEBITO NOT IN ('Pago');

/*ATIVIDADE 3*/
UPDATE DEBITOS SET SITUACAO_DEBITO = DATEADD(-5 YEAR TO DATAVENCIMENTO) 
WHERE SITUACAO_DEBITO = 'Negociado'

/*ATIVIDADE 4*/
SELECT p.NOME, p.EMAIL, p.TELEFONE FROM PESSOA p 

/*ATIVIDADE 5*/
SELECT p.PRECO_UNITARIO FROM PRODUTO p 
WHERE p.PRECO_UNITARIO > 100

/*ATIVIDADE 6*/
SELECT v.DATA_VENDA FROM VENDA v 
WHERE v.DATA_VENDA = '2022/04/01'

/*ATIVIDADE 7*/
SELECT p.NOME
     , p.DATA_NASCIMENTO
     , (EXTRACT(YEAR FROM current_date) - EXTRACT(YEAR FROM p.DATA_NASCIMENTO))
  FROM PESSOA p 
  INNER JOIN FORNECEDOR f ON f.ID_PESSOA = p.ID_PESSOA 
  LEFT JOIN PRODUTO p2 ON p2.ID_FORNECEDOR = f.ID_FORNECEDOR 
  WHERE p2.QUANTIDADE_ESTOQUE = 0 OR p2.QUANTIDADE_ESTOQUE = NULL 
  
/*ATIVIDADE 8*/
SELECT p.ID_PESSOA 
     , P.NOME 
     , p.TELEFONE 
     , d.DATAVENCIMENTO
  FROM PESSOA p 
  INNER JOIN DEBITOS d ON p.ID_PESSOA = d.ID_CLIENTE
  WHERE d.DATAVENCIMENTO < CURRENT_DATE AND d.SITUACAO_DEBITO IN ('Pendente','Atrasado')
  
/*ATIVIDADE 9 ANULADA*/

/*ATIVIDADE 10*/
SELECT FIRST 10 c.ID_CLIENTE
     , p.NOME
     , (EXTRACT(YEAR FROM CURRENT_DATE) - EXTRACT(YEAR FROM p.DATA_NASCIMENTO)) AS IDADE
     , COALESCE((SELECT SUM(d.VALOR_TOTAL)
  FROM DEBITOS d
  WHERE d.ID_CLIENTE = c.ID_CLIENTE AND d.SITUACAO_DEBITO = 'Atrasado'),0) AS TOTAL_DEBITOS_VENCIDOS
  , COALESCE((SELECT SUM(d.VALOR_TOTAL)
  FROM DEBITOS d
  WHERE d.ID_CLIENTE = c.ID_CLIENTE
  AND d.SITUACAO_DEBITO = 'Pago'),0) AS TOTAL_DEBITOS_PAGOS
  FROM CLIENTE c
  INNER JOIN PESSOA p ON c.ID_PESSOA = p.ID_PESSOA
  ORDER BY 4 DESC
  
/*ATIVIDADE 11*/
UPDATE PRODUTO SET PRECO_UNITARIO = PRECO_UNITARIO * 1.10
WHERE QUANTIDADE_ESTOQUE  < 10

/*ATIVIDADE 12 ANULADA*/

/*ATIVIDADE 13*/
UPDATE DEBITOS SET SITUACAO_DEBITO = 'Pago'
WHERE SITUACAO_DEBITO = 'Atrasado' AND ID_DEBITO IN (
SELECT ID_DEBITO FROM PAGAMENTO
);

/*ATIVIDADE 15*/
SELECT * FROM VENDA v

/*ATIVIDADE 16*/
SELECT * FROM PRODUTO p 
WHERE QUANTIDADE_ESTOQUE BETWEEN 5 AND 20

/*ATIVIDADE 17*/
SELECT p.NOME FROM PESSOA p
WHERE NOME LIKE 'A%'

/*ATIVIDADE 18*/
SELECT * FROM PRODUTO p 
LEFT JOIN ITENSVENDA i ON p.ID_PRODUTO = i .ID_PRODUTO 
WHERE i.ID_PRODUTO IS NULL;

/*ATIVIDADE 19*/
SELECT p.Nome FROM PRODUTO p
INNER JOIN FORNECEDOR f ON p.ID_FORNECEDOR = f.ID_FORNECEDOR
INNER JOIN PESSOA p2 ON f.ID_PESSOA = p2.ID_PESSOA
WHERE p2.NOME IN ('Carla Souza', 'Larissa Ferreira')

/*ATIVIDADE 20*/
SELECT DISTINCT p.NOME FROM PESSOA p 
LEFT JOIN CLIENTE c ON p.ID_PESSOA = c.ID_PESSOA 
LEFT JOIN FORNECEDOR f ON p.ID_PESSOA = f.ID_PESSOA 
WHERE c.ID_PESSOA IS NOT NULL OR f.ID_PESSOA IS NOT NULL 

/*ATIVIDADE 21*/
SELECT v.*
     , c.*
     , p.*
     , fp.*
FROM VENDA v
INNER JOIN CLIENTE c ON v.ID_PESSOA = c.ID_PESSOA
INNER JOIN PESSOA p ON c.ID_PESSOA = p.ID_PESSOA
INNER JOIN FORMA_PAGAMENTO fp ON v.ID_FORMA_PAGAMENTO = fp.ID_FORMA_PAGAMENTO

/*ATIVIDADE 22*/
SELECT v.*
     , p.* 
FROM VENDA v
INNER JOIN ITENSVENDA i ON v.ID_VENDA = i.ID_VENDA
INNER JOIN PRODUTO p ON i.ID_PRODUTO = p.ID_PRODUTO
WHERE p.NOME = 'Placa de Captura'

/*ATIVIDADE 23*/
SELECT cast('Eu sou cliente' AS varchar(30)) AS tipo
     , p.Nome
     , p.ID_PESSOA
     , (2025 - EXTRACT(YEAR FROM p.DATA_NASCIMENTO)) AS idade_2025
FROM PESSOA p
INNER JOIN CLIENTE c ON c.ID_PESSOA = p.ID_PESSOA

UNION

SELECT cast('Eu sou forncedor' AS varchar(30))
     , p.Nome
     , p.ID_PESSOA
     , (2025 - EXTRACT(YEAR FROM p.DATA_NASCIMENTO)) AS idade_2025
FROM PESSOA p
INNER JOIN FORNECEDOR f ON f.ID_PESSOA = p.ID_PESSOA


/*ATIVIDADE 24*/
SELECT e.ID_LOGRADOURO
    , l.NOME AS Nome_Rua
    , e.ID_BAIRRO
    , b.NOME AS Nome_Bairro
    , p.Nome AS Nome_Pessoa
    , p.EMAIL
FROM ENDERECO e
INNER JOIN LOGRADOURO l ON l.ID_LOGRADOURO = e.ID_LOGRADOURO
INNER JOIN BAIRRO b ON b.ID_BAIRRO = e.ID_BAIRRO
INNER JOIN PESSOA p ON p.ID_PESSOA = e.ID_PESSOA
ORDER BY 4, 2, 5;


/*ATIVIDADE 25*/
SELECT P2.NOME, p2.PRECO_UNITARIO FROM PRODUTO p2
WHERE PRECO_UNITARIO > (SELECT AVG(p2.PRECO_UNITARIO) FROM PRODUTO p2)

/*ATIVIDADE 26*/
SELECT p.NOME AS Nome_Pessoa
      , c.*
      , m.Nome AS Nome_Municipio
      , m.POPULACAO AS QTD_PESSOAS
FROM VENDA v
INNER JOIN CLIENTE c ON v.ID_PESSOA = c.ID_PESSOA
INNER JOIN PESSOA p ON c.ID_PESSOA = p.ID_PESSOA
INNER JOIN ENDERECO e ON p.ID_PESSOA = e.ID_PESSOA
INNER JOIN MUNICIPIO m ON e.ID_MUNICIPIO = m.ID_MUNICIPIO
WHERE m.POPULACAO > 900000    

/*ATIVIDADE 27*/
SELECT p2.NOME AS NOME_FORNECEDOR
, SUM(iv.QUANTIDADE) AS TOTAL_PRODUTOS_VENDIDOS
FROM ITENSVENDA iv
INNER JOIN PRODUTO p ON p.ID_PRODUTO = iv.ID_PRODUTO
INNER JOIN FORNECEDOR f ON f.ID_FORNECEDOR = p.ID_FORNECEDOR
INNER JOIN PESSOA p2 ON p2.ID_PESSOA = f.ID_PESSOA
GROUP BY p2.NOME

/*ATIVIDADE 28*/
SELECT * FROM CLIENTE c 
INNER JOIN HISTORICO_COMPRAS_CLIENTE hcc ON hcc.ID_CLIENTE = c.ID_CLIENTE 
WHERE hcc.VALOR_TOTAL > 500


/*ATIVIDADE 29*/
SELECT p.NOME, m.NOME AS cidade, b.NOME AS bairro, l.NOME AS rua
     FROM ENDERECO e
     LEFT JOIN BAIRRO b ON b.ID_BAIRRO = e.ID_BAIRRO
     LEFT JOIN MUNICIPIO m ON m.ID_MUNICIPIO = e.ID_MUNICIPIO
     LEFT JOIN LOGRADOURO l ON l.ID_LOGRADOURO = e.ID_LOGRADOURO
     LEFT JOIN PESSOA p ON p.ID_PESSOA = e.ID_PESSOA


/*ATIVIDADE 30*/
SELECT p.Nome AS Nome_Produto
	 , p.PRECO_UNITARIO AS Preco_Produto
	 , p2.Nome AS Nome_Fornecedor
FROM PRODUTO p 
INNER JOIN FORNECEDOR f ON p.ID_FORNECEDOR = f.ID_FORNECEDOR
INNER JOIN PESSOA p2 ON f.ID_PESSOA = p2.ID_PESSOA


/*EXERCICIO 31*/
SELECT p.QUANTIDADE_ESTOQUE FROM PRODUTO p
ORDER BY p.QUANTIDADE_ESTOQUE DESC


/*ATIVIDADE 32*/
SELECT v.VALOR_TOTAL FROM VENDA v 
ORDER BY v.VALOR_TOTAL ASC


/*ATIVIDADE 33*/
SELECT P.NOME AS Nome_Produto
	 , P.PRECO_UNITARIO AS Preco_Produto
	 , P.QUANTIDADE_ESTOQUE AS Quantidade_em_Estoque
FROM PRODUTO p 
WHERE p.QUANTIDADE_ESTOQUE < (SELECT AVG(QUANTIDADE_ESTOQUE)FROM PRODUTO p)


/*ATIVIDADE 34*/
SELECT p.NOME, p.TELEFONE
FROM PESSOA p
WHERE p.TELEFONE IN ( SELECT p2.TELEFONE FROM PESSOA p2 WHERE p.ID_PESSOA != p2.ID_PESSOA )


/*ATIVIDADE 35*/
UPDATE PRODUTO p
SET p.PRECO_UNITARIO = p.PRECO_UNITARIO * 1.10
WHERE p.ID_FORNECEDOR IN (
 SELECT f.ID_FORNECEDOR
 FROM FORNECEDOR f
 JOIN PESSOA pe ON f.ID_PESSOA = pe.ID_PESSOA
 JOIN ENDERECO e ON pe.ID_PESSOA = e.ID_PESSOA
 JOIN MUNICIPIO m ON e.ID_MUNICIPIO = m.ID_MUNICIPIO
 WHERE m.UF = 'SP')


/*ATIVIDADE 36*/
SELECT v.ID_VENDA
	 , v.VALOR_TOTAL
	 , v.DATA_VENDA
	 , v.ID_PESSOA
	 , p.NOME AS Nome_pessoa
	 , d.SITUACAO_DEBITO 
FROM VENDA v
INNER JOIN DEBITOS d ON d.ID_VENDA = v.ID_VENDA 
INNER JOIN PESSOA p ON p.ID_PESSOA = v.ID_PESSOA 
WHERE d.SITUACAO_DEBITO = 'Negociado'